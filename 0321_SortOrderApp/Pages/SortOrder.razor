@page "/sortorder2"

<PageTitle>順番決めアプリ</PageTitle>

<h2>順番決めアプリ（一人ずつ表示）</h2>

<label style="display:block;">名前入力欄</label>
<textarea @bind="inputText" disabled=@displayResult style="width: 300px; height: 200px;" placeholder="名前を入力してください(改行区切り)"></textarea>
<button @onclick="OnSetClicked" disabled=@displayResult>シャッフル</button>
<hr />

<div hidden="@(!displayResult)" style="text-align:center;" >
    <button style="width: 80px; " @onclick="OnNextClicked">@buttonText</button>
    <div style="font-size: 50pt;">@currentName</div> 
    @if(0 < orderNumber)
    {
        <p>@($"{orderNumber} / {namesCount}")</p>
    }
</div>

@code {
    private string inputText = "";
    private bool displayResult = false;
    private List<string> orderedList = new List<string>();
    Random r = new Random();

    private int orderNumber = 0;
    private string currentName = "　";
    private string buttonText = "";
    private int namesCount;

    private void OnSetClicked()
    {
        orderedList.Clear();

        var nameList = inputText.Split(Environment.NewLine).ToList();

        int n = nameList.Count;
        namesCount = n;
        for(int i =0; i < n; i++)
        {
            var randomNum = r.Next(0, n - i);
            orderedList.Add(nameList[randomNum]);
            nameList.RemoveAt(randomNum);
        }
        buttonText = "スタート";
        displayResult = true;
    }

    private void OnNextClicked()
    {
        if(orderNumber < orderedList.Count)
        {
            currentName = orderedList[orderNumber];
            orderNumber++;
            if(orderNumber < orderedList.Count)
            {
                buttonText = "次へ";
            }
            else
            {
                buttonText = "終了";
            }
        }
        else
        {
            orderNumber = 0;
            currentName = "　";
            displayResult = false;
        }
    }
}
